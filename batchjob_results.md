# Results for batchjob.sh script

## Summary
+ No predictive value gain is observed by adding 3 specified metabolite
concentrations for both full cohort and eGFR>60+ACR>30 stratum.
+ A gain in predicitve value is observed with deeper NN models.

Model AUCs are presented in the table below

|Model|AUC| 95% confidence interval|
|---|---|---|
|clin+metabo (stratum)| 0.4830895882310466| (0.4120590739753968, 0.5541201024866964)|
|clin only (stratum)| 0.5119298235372632 |(0.44664397676807677, 0.5772156703064497)|
|clin+metabo (full cohort)|0.5139866985416506 |(0.4506014605029618, 0.5773719365803394)|
|clin only (full cohort)|0.5530969544749911 |(0.4886172061276475, 0.6175767028223347)|
|(deep) clin+metabo (stratum)|0.6052857953095849 |(0.5904210978787608, 0.620150492740409)|
|(deep) clin only (stratum)|0.610683670361367| (0.5963186026963713, 0.6250487380263626)|
|(deep) clin+metabo (full cohort)|0.6082934545588173 |(0.5954502501015999, 0.6211366590160348)|
|(deep) clin only (full cohort)|0.6150679237863537 |(0.5973175786856654, 0.632818268887042)|


## Model description
Eight models where analyzed. Models A, B, C, and D correspond to the 2-by-2
combination of input variables (clinical and clinical+metabolites) with
population strata (fullcohort and eGFR>60+acr>30). These models characteristics
are summarized in the table below.

 | variables(down), stratum(accross)  |  eGFR>60 and acr>30 | fullcohort |
 |---|------------|--------------------|
 | **clinical + metabolites** | A | C |
 | **clinical** | B | D |

These 4 models represent shallow networks with logistic top layer activation.
They are generalizations of the logistic regression model with body plan denoted
as **10-1** for models A and C and **7-1** for models B and D. This notation is
read left to right with the first number representing the number of variables
feed into the input layer and the last number representing the number of output
values (predictions) in the top layer. Layers are separated by "-" sign. These
shallow networks consist only of an input and output layer. Deeper networks with
bodyplans **10-10-1** for models A\* and C\* and **7-10-1** for models B\* and
D\* are used to asses if any predictive gains can be made with deeper models.

## Training and Analysis description
All model layers have logistic activation and will return a top layer output value
between 0 and 1 representing the binary classification of controls and cases
respectively. The models are trained by steepest descent with a mean square
error loss function. Available stratum data is partitioned uniform-randomly with
80% used for training and 20% reserved for validation. Validation returns the
model out-sample error (OSE). Models are trained on the training set until
convergence with OSE calculated periodically along the training history. Once
training has completed the model with the lowest OSE is returned, not
necessarily the final converged model, to avoid overfitting.

For each returned model the receiver operating characteristic (ROC) is calculated
by dialing the classification threshold from 0 to 1 in .001 increments. An optimal
classification threshold is chosen that maximizes the model accuracy and the following
model performance measures are returned : area under the curve, accuracy, sensitivity,
specificity, false negative rate, false positive rate, positive predictive value,
negative predictive value, false discovery rate, false omission rate, positive
likelihood ratio, negative likelihood ratio, diagnostic odds ratio, and F1 score.   

The training process is repeated 100 times for each model to calculate the mean
and 95% confidence interval for each one of these performance measures.

## Data Preprocessing
Input variables were predefined and consist of clinical variables
("age","sex","diabetes_duration",
"baseline_a1c","egfr_v0","acr_v0","systolic_bp_v0")
and metabolite concentrations for
"u_x3_methyl_crotonyl_glycine_v0_gcms_badj",
"u_citric_acid_v0_gcms_badj", and
"u_glycolic_acid_v0_gcms_badj".

The R-markdown file [jdrf.Rmd](jdrf.Rmd) provided was used to generate the
datasets from the JDRF rawdata (not provided). In summary:
+ ACR is log2 transformed.
+ Metabolite concentrations are log2 transformed then mean centered and transformed for
 unit variance.
+ The sex binary classifier is shifted from (1,2) to values 0 and 1.

## Model A
| Measure | Mean | 95% confidence interval|
|---|---|---|
|AreaUnderCurve| 0.4830895882310466| (0.4120590739753968, 0.5541201024866964)|
|OptimalThreshold| 0.6610799999999999| (0.5965567334564712, 0.7256032665435286)|
|Accuracy| 0.7348849359895441| (0.7116110479368999, 0.7581588240421883)|
|Prevalence| 0.28093945143316734| (0.27030730718270385, 0.29157159568363084)|
|Sensitivity| 0.34692414994170606| (0.2996207892551986, 0.39422751062821354)|
|Specificity| 0.8872623367818012| (0.8525193008946911, 0.9220053726689114)|
|FalseNegRate| 0.6530758500582938 |(0.6057724893717864, 0.7003792107448013)|
|FalsePosRate| 0.11273766321819884| (0.07799462733108872, 0.14748069910530895)|
|PosPredValue| 0.5427522485458778 |(0.48708886100553805, 0.5984156360862175)|
|NegPredValue| 0.7776697000222041 |(0.7632230681841311, 0.7921163318602772)|
|FalseDiscRate| 0.4572477514541222 |(0.4015843639137825, 0.512911138994462)|
|FalseOmitRate| 0.22233029997779583 |(0.20788366813972275, 0.2367769318158689)|
|PosLikelihoodRatio| 5.571753371445762 |(4.5035562707009, 6.639950472190625)|
|NegLikelihoodRatio| 0.75696386395013|(0.699437923859474, 0.8144898040407861)|
|DiagnosticOddsRatio| 9.526826177168012 |(7.4917515948199735, 11.56190075951605)|
|F1Score| 0.3870014102393181|(0.3426475751593723, 0.43135524531926395)|
## Model A* Results
| Measure | Mean | 95% confidence interval|
|---|---|---|
|AreaUnderCurve| 0.6052857953095849 |(0.5904210978787608, 0.620150492740409)|
|OptimalThreshold| 0.52784 |(0.49278964482074394, 0.562890355179256)|
|Accuracy| 0.7700821772179597 |(0.7610115340113138, 0.7791528204246055)|
|Prevalence| 0.29330464258162897 |(0.2841320473989377, 0.30247723776432023)|
|Sensitivity |0.434414105401486 |(0.3995380687030907, 0.4692901420998813)|
|Specificity| 0.9044700075920492 |(0.8914014344956694, 0.917538580688429)|
|FalseNegRate |0.565585894598514|(0.5307098579001188, 0.6004619312969093)|
|FalsePosRate| 0.09552999240795086 |(0.08246141931157105, 0.10859856550433067)|
|PosPredValue|0.6791918498164763| (0.6609893732067001, 0.6973943264262524)|
|NegPredValue |0.7989049763924919 |(0.7881269052995388, 0.8096830474854451)|
|FalseDiscRate |0.32080815018352365 |(0.3026056735737475, 0.3390106267932998)|
|FalseOmitRate |0.201095023607508 |(0.1903169525145548, 0.2118730947004612)|
|PosLikelihoodRatio |6.137302240743928| (5.41498090929309, 6.859623572194766)|
|NegLikelihoodRatio|0.617849158173548 |(0.5844341989988326, 0.6512641173482634)|
|DiagnosticOddsRatio |10.739021084552014 |(9.37232657710669, 12.105715591997338)|
|F1Score| 0.5055808816227189| (0.4795518732462871, 0.5316098899991506)|
## Model B Results
| Measure | Mean | 95% confidence interval|
|---|---|---|
|AreaUnderCurve| 0.5119298235372632 |(0.44664397676807677, 0.5772156703064497)|
|OptimalThreshold| 0.63007 |(0.566882288111582, 0.693257711888418)|
|Accuracy |0.7644709647849907| (0.7455518535466991, 0.7833900760232823)|
|Prevalence |0.27537418884706344 |(0.2660965162658658, 0.2846518614282611)|
|Sensitivity |0.3798528941588068 |(0.3338410011287423, 0.4258647871888713)|
|Specificity |0.9077107819542912 |(0.8792625410905185, 0.936159022818064)|
|FalseNegRate |0.6201471058411933 |(0.5741352128111288, 0.6661589988712577)|
|FalsePosRate| 0.09228921804570853|(0.06384097718193585, 0.1207374589094812)|
|PosPredValue |0.5982334647437153 |(0.5458419362354534, 0.6506249932519772)|
|NegPredValue |0.7970944377607432| (0.7839049600079668, 0.8102839155135195)|
|FalseDiscRate |0.4017665352562847 |(0.34937500674802274, 0.45415806376454665)|
|FalseOmitRate |0.20290556223925685 |(0.18971608448648047, 0.21609503999203322)|
|PosLikelihoodRatio |7.26976228632211 |(5.962408311271384, 8.577116261372836)|
|NegLikelihoodRatio| 0.6835001611192963 |(0.6381142088172397, 0.728886113421353)|
|DiagnosticOddsRatio |13.591424259180217 |(10.596978403406194, 16.58587011495424)|
|F1Score| 0.43588612803220217 |(0.39128627436690666, 0.4804859816974977)|
## Model B* Results
| Measure | Mean | 95% confidence interval|
|---|---|---|
|AreaUnderCurve |0.610683670361367| (0.5963186026963713, 0.6250487380263626)|
|OptimalThreshold |0.49355 |(0.45859878459736864, 0.5285012154026313)|
|Accuracy |0.7778786010962538 |(0.7697151040515373, 0.7860420981409704)|
|Prevalence |0.28431815096942775| (0.2750349930922392, 0.2936013088466163)|
|Sensitivity |0.4471528207744455 |(0.4111471353007736, 0.4831585062481174)|
|Specificity |0.9041773956875018 |(0.8902220049064778, 0.9181327864685257)|
|FalseNegRate |0.5528471792255545| (0.5168414937518826, 0.5888528646992264)|
|FalsePosRate |0.0958226043124982 |(0.08186721353147432, 0.10977799509352208)|
|PosPredValue |0.6768103781787401 |(0.6569331086438883, 0.6966876477135919)|
|NegPredValue |0.810651410385711| (0.8006721843239347, 0.8206306364474872)|
|FalseDiscRate |0.3231896218212596 |(0.30331235228640774, 0.34306689135611146)|
|FalseOmitRate |0.18934858961428894 |(0.1793693635525127, 0.19932781567606517)|
|PosLikelihoodRatio |6.314061953878663 |(5.647681131115943, 6.980442776641382)|
|NegLikelihoodRatio |0.6025183088765621| (0.5686071550510545, 0.6364294627020697)|
|DiagnosticOddsRatio |11.221290703835926 |(9.955495147111122, 12.48708626056073)|
|F1Score |0.5114694583259185 |(0.4853182758990154, 0.5376206407528217)|
## Model C Results
| Measure | Mean | 95% confidence interval|
|---|---|---|
|AreaUnderCurve|0.5139866985416506 |(0.4506014605029618, 0.5773719365803394)|
|OptimalThreshold| 0.6915100000000001 |(0.6291885060175567, 0.7538314939824434)|
|Accuracy |0.7422164540956387 |(0.721103506644101, 0.7633294015471764)|
|Prevalence |0.27531041403062795 |(0.2649056060372651, 0.2857152220239908)|
|Sensitivity |0.3567235337137848 |(0.309283053902911, 0.4041640135246586)|
|Specificity |0.8837565625743622 |(0.8522848116726761, 0.9152283134760483)|
|FalseNegRate| 0.6432764662862153 |(0.5958359864753415, 0.690716946097089)|
|FalsePosRate |0.11624343742563768|(0.0847716865239516, 0.14771518832732378)|
|PosPredValue |0.5341849572570099 |(0.48159106450608, 0.5867788500079397)|
|NegPredValue |0.78656083309976 |(0.7729051001737913, 0.8002165660257287)|
|FalseDiscRate |0.4658150427429901 |(0.4132211499920603, 0.51840893549392)|
|FalseOmitRate |0.21343916690023998 |(0.1997834339742713, 0.22709489982620865)|
|PosLikelihoodRatio |5.065046667287155 |(4.144631137542021, 5.985462197032289)|
|NegLikelihoodRatio |0.749355501754435 |(0.6839483598971092, 0.8147626436117608)|
|DiagnosticOddsRatio |9.008954114361398 |(7.167102902931771, 10.850805325791024)|
|F1Score| 0.39656303416895766 |(0.35188809712749963, 0.4412379712104157)|
## Model C* Results
| Measure | Mean | 95% confidence interval|
|---|---|---|
|AreaUnderCurve |0.6082934545588173 |(0.5954502501015999, 0.6211366590160348)|
|OptimalThreshold |0.52948 |(0.495654554589262, 0.5633054454107379)|
|Accuracy |0.771267003323475 |(0.761334105443922, 0.781199901203028)|
|Prevalence| 0.28769760190117016 |(0.27643331519390063, 0.2989618886084397)|
|Sensitivity| 0.4227723925842583 |(0.38788435482938144, 0.45766043033913517)|
|Specificity |0.9064592980274051 |(0.8912876358136526, 0.9216309602411576)|
|FalseNegRate |0.5772276074157416| (0.5423395696608648, 0.6121156451706184)|
|FalsePosRate |0.09354070197259506| (0.07836903975884246, 0.10871236418634767)|
|PosPredValue |0.6817904680578691 |(0.6632354613074714, 0.7003454748082669)|
|NegPredValue |0.7996029203544329 |(0.7884237719558888, 0.8107820687529771)|
|FalseDiscRate| 0.3182095319421307 |(0.29965452519173286, 0.33676453869252854)|
|FalseOmitRate |0.20039707964556722 |(0.18921793124702302, 0.21157622804411141)|
|PosLikelihoodRatio |6.4924195514013014 |(5.6996712253829465, 7.285167877419656)|
|NegLikelihoodRatio |0.6284078470826212 |(0.5968546423270588, 0.6599610518381837)|
|DiagnosticOddsRatio| 10.974907149229155 |(9.398760903076361, 12.551053395381949)|
|F1Score |0.49311013087377953 |(0.4660795306203377, 0.5201407311272214)|
## Model D Results
| Measure | Mean | 95% confidence interval|
|---|---|---|
|AreaUnderCurve |0.5530969544749911 |(0.4886172061276475, 0.6175767028223347)|
|OptimalThreshold |0.61104| (0.5463073281806082, 0.6757726718193918)|
|Accuracy |0.7480350714802249|(0.7268032792507354, 0.7692668637097143)|
|Prevalence |0.2808974979577476 (|0.2721287986998715, 0.2896661972156237)|
|Sensitivity |0.39504320010922156 |(0.35062633929619685, 0.43946006092224627)|
|Specificity |0.8850347711480002| (0.8511513792090214, 0.918918163086979)|
|FalseNegRate |0.6049567998907784 |(0.5605399390777538, 0.6493736607038031)|
|FalsePosRate|0.1149652288519997 |(0.08108183691302086, 0.14884862079097855)|
|PosPredValue |0.6117218519735921 |(0.5711612855663235, 0.6522824183808607)|
|NegPredValue |0.7858016589168813 |(0.7703245743888225, 0.80127874344494)|
|FalseDiscRate |0.38827814802640787 |(0.3477175816191393, 0.42883871443367644)|
|FalseOmitRate| 0.21419834108311878 |(0.19872125655505998, 0.22967542561117757)|
|PosLikelihoodRatio |5.87084097288534 |(5.018966352144133, 6.722715593626546)|
|NegLikelihoodRatio |0.7303583131046218| (0.6563676291322931, 0.8043489970769506)|
|DiagnosticOddsRatio |10.45162973374118 |(8.693625298075812, 12.209634169406549)|
|F1Score |0.4415926727834386 |(0.40397794851115126, 0.47920739705572596)|
## Model D* Results
| Measure | Mean | 95% confidence interval|
|---|---|---|
|AreaUnderCurve| 0.6150679237863537 |(0.5973175786856654, 0.632818268887042)|
|OptimalThreshold| 0.5165000000000001 |(0.48350771703257184, 0.5494922829674284)|
|Accuracy |0.7708155906587184 |(0.7609562230722569, 0.78067495824518)|
|Prevalence |0.29073305136523764 |(0.28094966281552014, 0.30051643991495514)|
|Sensitivity |0.466926281711806 |(0.43131101535939487, 0.5025415480642171)|
|Specificity |0.8929309387165232 |(0.8778797149830845, 0.9079821624499619)|
|FalseNegRate| 0.5330737182881938 |(0.49745845193578264, 0.568688984640605)|
|FalsePosRate| 0.10706906128347661 |(0.09201783755003785, 0.12212028501691537)|
|PosPredValue| 0.6716571926933415 |(0.6512868320995389, 0.692027553287144)|
|NegPredValue| 0.8072707135230515 |(0.7956127552193895, 0.8189286718267135)|
|FalseDiscRate| 0.3283428073066586 |(0.307972446712856, 0.3487131679004612)|
|FalseOmitRate |0.1927292864769485 |(0.18107132817328656, 0.20438724478061046)|
|PosLikelihoodRatio| 6.255370383582182 |(5.43862592103549, 7.0721148461288745)|
|NegLikelihoodRatio |0.5883776318715777 |(0.55509483577556, 0.6216604279675954)|
|DiagnosticOddsRatio |11.350731052887355 |(9.792333346751478, 12.90912875902323)|
|F1Score |0.522670037725675 |(0.49709087017534304, 0.548249205276007)|
